<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>내 매장 관리</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <th:block th:replace="~{header/header :: header-css}"></th:block>
    <style>
        body { padding-top: 80px; background-color: #f8f9fa; font-family: 'Pretendard', sans-serif; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .store-card {
            background: white; border-radius: 10px; padding: 20px; margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center;
        }
        .store-info h3 { margin: 0 0 5px 0; color: #333; }
        .store-info p { margin: 0; color: #777; font-size: 0.9rem; }
        .btn-manage { background-color: #007bff; color: white; text-decoration: none; padding: 8px 16px; border-radius: 5px; font-size: 0.85rem; }
        .btn-create { background-color: #28a745; color: white; text-decoration: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; }
        .no-data { text-align: center; padding: 50px; color: #aaa; }
    </style>
</head>
<body>
<div th:replace="~{header/header :: main-header}"></div>

<div class="container">
    <div class="page-header">
        <h2>내 매장 관리</h2>
        <a href="/store/createStore" class="btn-create">+ 새 매장 등록</a>
    </div>

    <div id="store-list">
        <p style="text-align: center;">매장 정보를 불러오는 중...</p>
    </div>
</div>

<th:block th:replace="~{header/header :: header-js}"></th:block>

<script>
    document.addEventListener('DOMContentLoaded', async function () {
        const storeListContainer = document.getElementById('store-list');

        try {
            // 백엔드의 매장 조회 API 호출 (위에서 만든 /my-stores 가정)
            const response = await fetchWithAuth('/store/viewMyStore');

            if (response.ok) {
                const stores = await response.json();
                storeListContainer.innerHTML = ''; // 로딩 문구 제거

                if (stores.length === 0) {
                    storeListContainer.innerHTML = '<div class="no-data">등록된 매장이 없습니다.</div>';
                    return;
                }

                stores.forEach(store => {
                    const card = document.createElement('div');
                    card.className = 'store-card';
                    card.innerHTML = `
                        <div class="store-info">
                            <h3>${store.name}</h3>
                            <p>${store.address}</p>
                            <p style="color: #555; font-size: 0.85rem; margin-top: 5px;">
                                영업시간: ${store.openTime ? store.openTime.substring(0,5) : '미설정'} ~ ${store.closeTime ? store.closeTime.substring(0,5) : '미설정'}
                            </p>
                        </div>
                        <div class="store-actions" style="display: flex; flex-direction: column; gap: 8px;">
                            <a href="/store/reservation/${store.id}" class="btn-manage" style="background-color: #6c757d;">예약 확인</a>
                            <a href="/store/manage/${store.id}" class="btn-manage">관리하기</a>
                        </div>
                    `;
                    storeListContainer.appendChild(card);
                });
            } else {
                storeListContainer.innerHTML = '<div class="no-data">매장 정보를 불러오는데 실패했습니다.</div>';
            }
        } catch (error) {
            console.error("Error:", error);
            storeListContainer.innerHTML = '<div class="no-data">오류가 발생했습니다.</div>';
        }
    });
</script>
</body>
</html>