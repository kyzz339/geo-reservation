<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>매장 예약 현황</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <th:block th:replace="~{header/header :: header-css}"></th:block>
    <style>
        body { padding-top: 80px; background-color: #f8f9fa; font-family: 'Pretendard', sans-serif; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h2 { margin-bottom: 20px; color: #333; font-size: 1.5rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background-color: #fcfcfc; color: #666; font-weight: 600; font-size: 0.9rem; }
        td { font-size: 0.95rem; color: #444; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
        .status-pending { background-color: #fff3cd; color: #856404; }
        .status-canceled { background-color: #f8d7da; color: #721c24; }
        .no-data { text-align: center; padding: 50px; color: #aaa; }
    </style>
</head>
<body>
<div th:replace="~{header/header :: main-header}"></div>

<div class="container">
    <div class="card">
        <h2>매장 예약 현황</h2>
        <table id="reservation-table">
            <thead>
                <tr>
                    <th>예약자명</th>
                    <th>방문 인원</th>
                    <th>예약 시작 시간</th>
                    <th>종료 예정 시간</th>
                    <th>상태</th>
                </tr>
            </thead>
            <tbody id="reservation-list">
                <!-- 자바스크립트로 데이터 로드 -->
            </tbody>
        </table>
    </div>
</div>

<th:block th:replace="~{header/header :: header-js}"></th:block>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const urlPath = window.location.pathname;
        const storeId = urlPath.substring(urlPath.lastIndexOf('/') + 1);
        const listContainer = document.getElementById('reservation-list');

        try {
            const response = await fetchWithAuth(`/reservation/store/${storeId}`);
            if (response.ok) {
                const data = await response.json();
                listContainer.innerHTML = '';

                if (data.length === 0) {
                    listContainer.innerHTML = '<tr><td colspan="5" class="no-data">아직 예약 내역이 없습니다.</td></tr>';
                    return;
                }

                data.forEach(res => {
                    const row = document.createElement('tr');
                    const statusClass = res.status === 'PENDING' ? 'status-pending' : 'status-canceled';
                    row.innerHTML = `
                        <td><strong>${res.userName}</strong></td>
                        <td>${res.visitorCount}명</td>
                        <td>${res.reservedAt.replace('T', ' ')}</td>
                        <td>${res.finishedAt.replace('T', ' ')}</td>
                        <td><span class="status-badge ${statusClass}">${res.status}</span></td>
                    `;
                    listContainer.appendChild(row);
                });
            }
        } catch (err) { console.error(err); }
    });
</script>
</body>
</html>